[Rainmeter]
Update=1000
AccurateText=1
DynamicWindowSize=1

[Variables]
FolderPath1Waning=#@#Images\Moon\Waning
FolderPath2Waxing=#@#Images\Moon\Waxing
FileNamePrefix=Lunar_
FileExtension=.png

[MeasureWebparseMoonVisibility]
Measure=WebParser
UpdateRate=125000
URL=https://phasesmoon.com/
RegExp=(?siU)<div class="phasename">(.*)% Visible</div>(.*)<div>(.*)Moon's constellation (.*); (.*)</div>(.*)<div>(.*)Horoscope is (.*); (.*)</div>
StringIndex=1

[MeasureMoonVisibility]
Measure=Calc
Formula=[MeasureWebparseMoonVisibility]
DynamicVariables=1

[MeterMoonVisibility]
Meter=String
MeasureName=MeasureWebparseMoonVisibility
ClipString=1
FontColor=0,0,0,1
AntiAlias=1
Text="%1%"

[MeasureMoonPhase]
Measure=WebParser
UpdateRate=125000
URL=https://phasesmoon.com/
RegExp=(?siU)<img src="https://phasesmoon.com/moonpng/.*.png" alt="(.*)">.*Today, the moon phase is <strong><a href="https://phasesmoon.com/cycle/.*.html" title="(.*)">(.*)</a></strong>, with an illumination of .*%. It is currently (.*) days old on .*. The moon is currently located in the constellation of (.*); (.*).<div class=".*"></div>
StringIndex=3


[MeasureMoonPhaseSimple]
Measure=String
String=[MeasureMoonPhase]
DynamicVariables=1
RegExpSubstitute=1
Substitute="Full Moon":"Waning","Waning Gibbous":"Waning","Last Quarter":"Waning","Waning Crescent":"Waning","New Moon":"Waxing","Waxing Crescent":"Waxing","First Quarter":"Waxing","Waxing Gibbous":"Waxing"


[MeterMoonPhase]
Meter=String
MeasureName=MeasureMoonPhase
Padding=5,5,5,5
FontColor=0,0,0,1
StringAlign=Right
ClipString=1
AntiAlias=1

[MeterMoonSimple]
Meter=String
MeasureName=MeasureMoonPhaseSimple
Padding=5,5,5,5
FontColor=0,0,0,1
StringAlign=Right
ClipString=1
AntiAlias=1
Text="%1"

[MeasureCalcImage]
Measure=Calc
Formula=(2*(round(((round([MeasureMoonVisibility]))/2))))
IfCondition=([MeterMoonSimple]=Waning)
IfTrueAction=[!SetOption MeterCalcImage Formula "(2*(round(((round([MeasureMoonVisibility]))/2))))"]
IfFalseAction=[!SetOption MeterCalcImage Formula "(100+(2*(round(((round([MeasureMoonVisibility]))/2)))))"]
DynamicVariables=1

[MeterCalcImage]
Meter=String
MeasureName=MeasureCalcImage
SolidColor=0,0,0,1
Padding=5,5,5,5
StringAlign=Right
ClipString=1
AntiAlias=1
Text="%1"

[MeasureCalcImageFormatted]
Measure=String
String=[MeasureCalcImage]
DynamicVariables=1
RegExpSubstitute=1
Substitute="^([0-9]{1})$":"0000\1","^([0-9]{2})$":"000\1","^([0-9]{3})$":"00\1","^([0-9]{4})$":"0\1"
IfMatch=^0{5}$
IfMatchAction=[!SetOption MeterMoonImage ImageName "#@#Images\Moon\Placeholder-Deer.png"]
IfNotMatchAction=[!SetOption MeterMoonImage ImageName "#@#Images\Moon\%1\#FileNamePrefix#%2#FileExtension#"]


[MeasureUpdateActions]
Measure=Calc
Formula=1
DynamicVariables=1
UpdateDivider=-1
OnUpdateAction=[!UpdateMeasure MeasureCalcImageFormatted][!SetOption MeterMoonImage ImageName "#@#Images\Moon\Placeholder-Deer.png"][!UpdateMeter MeterMoonImage][!Redraw]


[MeterCalcImageFormatted]
Meter=String
MeasureName=MeasureCalcImageFormatted
SolidColor=0,0,0,1
Padding=5,5,5,5
StringAlign=Right
ClipString=1
AntiAlias=1
Text="%1"

[MeterMoonImage]
Meter=Image
MeasureName=MeasureMoonPhaseSimple
MeasureName2=MeasureCalcImageFormatted
PreserveAspectRatio=1
SolidColor=0,0,0,1
DynamicVariables=1


